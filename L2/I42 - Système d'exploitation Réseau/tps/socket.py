# coding: utf-8

""" Un client http très simple. """

import socket
import struct
import time

# Tout d'abord une interrogation du serveur DNS, même si on ne s'en sert pas.

print("Interrogation du DNS: " + socket.gethostbyname("sinfo4.univ-tln.fr"))
#On veut print "l'interrogation du DNS avec l'adresse sous format string"

# 1- Construction d'un objet qui représente la socket
#    vers laquelle le client veut se connecter

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#La classe socket.socket permet de créer un nouveau socket en donnant l'adresse, le type de socket
#et le numéro de protocole. Voir plus : https://docs.python.org/3/library/socket.html

# 2- ouverture de la connexion vers la socket

s.connect(("sinfo4.univ-tln.fr", 37))
#Port 37 car time protocol's port = 37

# 3- construction du message à envoyer, ici une requête http.

request = "GET / HTTP/1.1\r\n"
request += "Host: sinfo4.univ-tln.fr\r\n"
request += "Connection: Close\r\n\r\n"

# 4- envoi sur la socket

s.send(request.encode('UTF-8'))

# 5- lecture de 15 octets sur la socket (augmenter pour lire plus...)

data = s.recv(4)

# 6- convertion de la séquence de 15 octets en une chaîne de caractères
#    et l'afficher.
print(struct.unpack("=I", data))
print(int_from_bytes(data, byteorder='big'))
print(data.decode('utf-8'))

# 7- fermeture de la socket
s.close()
